tinymce.PluginManager.add("kodeisian", function (editor, url) {
    editor.ui.registry.addMenuButton("kodeisian", {
        text: "Kode Isian",
        fetch: function (callback) {
            var items = [];

            $.ajax({
                type: "GET",
                url: SITE_URL + "surat_master/kode_isian/" + editor.getElement().getAttribute('data-salintemplate') + "/" + $("#id_surat").val(),
                dataType: "json",
                processData: true,
                success: function (response) {
                    $.each(response, function (key, value) {
                        var menuItem = {
                            type: "nestedmenuitem",
                            text: key,
                            getSubmenuItems: function () {
                                return kode_isian(editor, value);
                            },
                        };
                        items.push(menuItem);
                    });

                    callback(items);
                },

                error: function (xhr, status, error) {
                    notifEditor("Error! " + xhr.status + "\n" + error, "error");
                },
            });
        },
    });
});

function kode_isian(editor, isian) {
    var kode_isian = [];

    $.each(isian, function (key, value) {
        var combine = {
            type: "nestedmenuitem",
            text: value.judul,
            getSubmenuItems: function () {
                let isian = value.isian;
                return [
                    {
                        // Normal
                        type: "menuitem",
                        text: "Normal",
                        onAction: function () {
                            editor.insertContent(isian.normal);
                        },
                    },
                    {
                        // Kecil Semua
                        type: "menuitem",
                        text: "Lowercase",
                        onAction: function () {
                            editor.insertContent(isian.lower);
                        },
                    },
                    {
                        // Huruf Besar Awal
                        type: "menuitem",
                        text: "Ucfirst",
                        onAction: function () {
                            editor.insertContent(isian.ucfirst);
                        },
                    },
                    {
                        // Huruf Besar Tiap Kata
                        type: "menuitem",
                        text: "Ucwords",
                        onAction: function () {
                            editor.insertContent(isian.ucwords);
                        },
                    },
                    {
                        // Besar Semua
                        type: "menuitem",
                        text: "Uppercase",
                        onAction: function () {
                            editor.insertContent(isian.upper);
                        },
                    },
                ];
            },
        };
        kode_isian.push(combine);
    });

    return kode_isian;
}
